<!-- Footer -->
<footer class="py-5 bg-dark">
  <div class="container">
    <p class="m-0 text-center text-white">
      Site réalisé par <a href="{{ site.data.author.info.website}}" target="_blank">{{ site.data.author.info.company-name }}</a>
    </p>
  </div>
  <!-- /.container -->
</footer>

<!-- Bootstrap core JavaScript -->
<script src="{{ site.baseurl }}/assets/vendor/jquery/jquery-3.5.1.min.js"></script>
<script src="{{ site.baseurl }}/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<script>
  window.addEventListener("DOMContentLoaded", function(event) {
    let alertBox = document.querySelector('.form-submission-message');
    let form = document.querySelector('form');
    let action = form.getAttribute('action');
    let name = document.querySelector('#name');
    let email = document.querySelector('#email');
    let phone = document.querySelector('#phone');
    let message = document.querySelector('#message');
    let emailRegExp = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    let phoneRegExp = /(([0-9]{2})[-. ]?){5}/;
    
    const fieldValidation = function(regex, input) {
      if(!regex.test(input.value)) {
        input.style.borderColor = "red";
      } else {
        input.style.borderColor = "green";
      }
    }

    email.addEventListener('keyup', function() {
      console.log(this);
      fieldValidation(emailRegExp, this);
    });
    phone.addEventListener('keyup', function() {
      console.log(this);
      fieldValidation(phoneRegExp, this);
    });

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      if (emailRegExp.test(email.value) && phoneRegExp.test(phone.value)) {

        const XHR = new XMLHttpRequest(), FD  = new FormData(form);
        XHR.addEventListener('load', function(event) { 
          alertBox.classList.remove('alert-danger');
          alertBox.classList.add('alert-success');
          alertBox.innerHTML = event.target.responseText;
        });
        XHR.addEventListener('error', function(event) { 
          alertBox.classList.remove('alert-success');
          alertBox.classList.add('alert-danger');
          alertBox.innerHTML = event.target.responseText;
        });
        XHR.open('POST', action);
        XHR.send(FD);

      } else {
        alertBox.classList.remove('alert-success');
        alertBox.classList.add('alert-warning');
        alertBox.innerHTML = "Formulaire incorrect";
      }
    });
  });
</script>